<!DOCTYPE html>
<html>
<head>
    <title>AI Code Reviewer - History</title>
    <meta name="decorator" content="atl.admin">
    <meta name="application-base-url" content="$baseUrl">
    $webResourceManager.requireResource("com.example.bitbucket.ai-code-reviewer:ai-reviewer-history-resources")
</head>
<body>
<header class="aui-page-header">
    <div class="aui-page-header-inner">
        <div class="aui-page-header-main">
            <h1>AI Code Reviewer History</h1>
        </div>
        <div class="aui-page-header-actions">
            <a class="aui-button" href="$baseUrl/plugins/servlet/ai-reviewer/admin">Back to Configuration</a>
        </div>
    </div>
</header>

<div class="aui-page-panel">
    <div class="aui-page-panel-inner">
        <section class="aui-page-panel-content">
            <div id="ai-reviewer-history-container">
                <div class="aui-toolbar2">
                    <div class="aui-toolbar2-inner">
                        <div class="aui-toolbar2-primary">
                            <label class="filter-label" for="filter-project">Project</label>
                            <input class="text filter-input" type="text" id="filter-project" placeholder="e.g. PROJ">
                            <label class="filter-label" for="filter-repo">Repository</label>
                            <input class="text filter-input" type="text" id="filter-repo" placeholder="slug">
                            <label class="filter-label" for="filter-pr">PR</label>
                            <input class="text filter-input" type="number" id="filter-pr" min="1" placeholder="#">
                            <button type="button" class="aui-button" id="refresh-history-btn">
                                <span class="aui-icon aui-icon-small aui-iconfont-refresh"></span> Refresh
                            </button>
                        </div>
                        <div class="aui-toolbar2-secondary">
                            <span class="history-hint">Filters are optional; blank values show everything.</span>
                        </div>
                    </div>
                </div>

                <div id="history-message" class="aui-message info" style="display:none;"></div>

                <section id="metrics-section" class="metrics-section" style="display:none;">
                    <header class="metrics-header">
                        <h2>Summary Metrics</h2>
                        <span id="metrics-subtitle" class="metrics-subtitle"></span>
                    </header>
                    <div id="metrics-message" class="aui-message info" style="display:none;"></div>
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <span class="metric-label">Total Reviews</span>
                            <span class="metric-value" id="metric-total-reviews">—</span>
                            <span class="metric-subtext" id="metric-status-breakdown">—</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-label">Average Duration</span>
                            <span class="metric-value" id="metric-avg-duration">—</span>
                            <span class="metric-subtext" id="metric-duration-detail">—</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-label">Issues Found</span>
                            <span class="metric-value" id="metric-total-issues">—</span>
                            <span class="metric-subtext" id="metric-issue-breakdown">—</span>
                        </div>
                        <div class="metric-card">
                            <span class="metric-label">Fallback Usage</span>
                            <span class="metric-value" id="metric-fallback-rate">—</span>
                            <span class="metric-subtext" id="metric-fallback-detail">—</span>
                        </div>
                    </div>
                </section>

                <table class="aui aui-table aui-table-rowhover" id="review-history-table">
                    <thead>
                    <tr>
                        <th>Start Time</th>
                        <th>Repository / PR</th>
                        <th>Status</th>
                        <th>Issues</th>
                        <th>Model</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="history-empty">
                        <td colspan="5">Loading history...</td>
                    </tr>
                    </tbody>
                </table>

                <section id="history-detail-panel" class="history-detail-panel" style="display:none;">
                    <header class="history-detail-header">
                        <h2>Review Details</h2>
                        <span id="history-detail-subtitle" class="detail-subtitle"></span>
                    </header>
                    <div id="detail-message" class="aui-message info" style="display:none;"></div>

                    <div class="history-detail-grid">
                        <div class="detail-block">
                            <h3>Overview</h3>
                            <dl id="detail-overview" class="detail-list"></dl>
                        </div>
                        <div class="detail-block">
                            <h3>Findings</h3>
                            <dl id="detail-findings" class="detail-list"></dl>
                        </div>
                        <div class="detail-block">
                            <h3>Model Summary</h3>
                            <dl id="detail-model" class="detail-list"></dl>
                        </div>
                    </div>

                    <div class="history-detail-chunks">
                        <h3>Chunk Invocations</h3>
                        <table class="aui aui-table aui-table-rowhover" id="chunk-table">
                            <thead>
                            <tr>
                                <th>#</th>
                                <th>Chunk</th>
                                <th>Role</th>
                                <th>Model</th>
                                <th>Attempts</th>
                                <th>Duration</th>
                                <th>Status</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr class="chunk-empty">
                                <td colspan="7">Select a review run to see chunk activity.</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>
        </section>
    </div>
</div>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <title>AI Code Reviewer - Health</title>
    <meta name="decorator" content="atl.admin">
    <meta name="application-base-url" content="$baseUrl">
    $webResourceManager.requireResource("com.teknolojikpanda.bitbucket.ai-code-reviewer:ai-reviewer-health-resources")
</head>
<body>
<header class="aui-page-header" style="padding-bottom: 20px;">
    <div class="aui-page-header-inner">
        <div class="aui-page-header-main">
            <h1>AI Code Reviewer Health</h1>
        </div>
        <div class="aui-page-header-actions">
            <a class="aui-button" href="$baseUrl/plugins/servlet/ai-reviewer/admin">Configuration</a>
            <a class="aui-button" href="$baseUrl/plugins/servlet/ai-reviewer/operations">Operations</a>
            <a class="aui-button" href="$baseUrl/plugins/servlet/ai-reviewer/history">History</a>
        </div>
    </div>
</header>

<div class="aui-page-panel">
    <div class="aui-page-panel-inner">
        <section class="aui-page-panel-content">
            <div id="ai-reviewer-health-container">
                <div class="health-toolbar">
                    <button type="button" class="aui-button" id="refresh-health-btn">
                        <span class="aui-icon aui-icon-small aui-iconfont-refresh"></span> Refresh
                    </button>
                    <span class="health-toolbar-note">Telemetry refreshes on demand.</span>
                </div>

                <div id="health-message" class="aui-message info" style="display:none;"></div>

                <section class="health-section">
                    <header class="health-header">
                        <h2>Runtime Snapshot</h2>
                        <span id="health-updated" class="health-updated">—</span>
                    </header>
                    <div class="health-grid">
                        <div class="health-card">
                            <span class="health-label">Queue</span>
                            <span class="health-value" id="health-queue-active">—</span>
                            <span class="health-subtext" id="health-queue-note">—</span>
                        </div>
                        <div class="health-card">
                            <span class="health-label">Worker Pool</span>
                            <span class="health-value" id="health-worker-active">—</span>
                            <span class="health-subtext" id="health-worker-note">—</span>
                        </div>
                        <div class="health-card">
                            <span class="health-label">Rate Limits</span>
                            <span class="health-value" id="health-rate-limit">—</span>
                            <span class="health-subtext" id="health-rate-note">—</span>
                        </div>
                        <div class="health-card">
                            <span class="health-label">Retention</span>
                            <span class="health-value" id="health-retention-total">—</span>
                            <span class="health-subtext" id="health-retention-note">—</span>
                        </div>
                    </div>
                </section>

                <section class="health-section" style="margin-top: 24px;">
                    <header class="health-header">
                        <h2>Metrics Summary</h2>
                        <span id="metrics-summary-updated" class="health-updated">—</span>
                    </header>
                    <div class="health-grid metrics-grid">
                        <div class="health-card metric-card metric-status-normal" id="metric-queue-waiting-card">
                            <span class="health-label">Queue Waiting</span>
                            <span class="health-value" id="metric-queue-waiting-value">—</span>
                            <span class="health-subtext" id="metric-queue-waiting-status">Loading…</span>
                        </div>
                        <div class="health-card metric-card metric-status-normal" id="metric-queue-slots-card">
                            <span class="health-label">Available Slots</span>
                            <span class="health-value" id="metric-queue-slots-value">—</span>
                            <span class="health-subtext" id="metric-queue-slots-status">Loading…</span>
                        </div>
                        <div class="health-card metric-card metric-status-normal" id="metric-worker-queued-card">
                            <span class="health-label">Worker Backlog</span>
                            <span class="health-value" id="metric-worker-queued-value">—</span>
                            <span class="health-subtext" id="metric-worker-queued-status">Loading…</span>
                        </div>
                        <div class="health-card metric-card metric-status-normal" id="metric-limiter-throttles-card">
                            <span class="health-label">Throttle Events</span>
                            <span class="health-value" id="metric-limiter-throttles-value">—</span>
                            <span class="health-subtext" id="metric-limiter-throttles-status">Loading…</span>
                        </div>
                        <div class="health-card metric-card metric-status-normal" id="metric-breaker-open-card">
                            <span class="health-label">Breaker Open %</span>
                            <span class="health-value" id="metric-breaker-open-value">—</span>
                            <span class="health-subtext" id="metric-breaker-open-status">Loading…</span>
                        </div>
                        <div class="health-card metric-card metric-status-normal" id="metric-cleanup-age-card">
                            <span class="health-label">Cleanup Lag</span>
                            <span class="health-value" id="metric-cleanup-age-value">—</span>
                            <span class="health-subtext" id="metric-cleanup-age-status">Loading…</span>
                        </div>
                    </div>
                    <div class="queue-note" id="metrics-summary-note">Metrics summary refreshes independently of the telemetry snapshot.</div>
                </section>

                <section class="queue-section" style="margin-top: 24px;">
                    <header class="queue-header">
                        <h2>Worker Pools by Node</h2>
                        <span id="worker-nodes-updated" class="queue-updated">—</span>
                    </header>
                    <div class="queue-panel">
                        <div class="queue-empty" id="worker-nodes-empty">Worker nodes have not reported telemetry yet.</div>
                        <table class="aui aui-table aui-table-rowhover" id="worker-nodes-table" style="display:none;">
                            <thead>
                            <tr>
                                <th>Node</th>
                                <th>Configured</th>
                                <th>Active</th>
                                <th>Queued</th>
                                <th>Utilization</th>
                                <th>Last Update</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>

                <section class="queue-section" style="margin-top: 24px;">
                    <header class="queue-header">
                        <h2>Scaling Hints</h2>
                        <span id="scaling-hints-updated" class="queue-updated">—</span>
                    </header>
                    <div class="queue-panel">
                        <div class="queue-empty" id="scaling-hints-empty">No scaling actions recommended.</div>
                        <ul class="health-list" id="scaling-hints-list" style="display:none;"></ul>
                    </div>
                </section>

                <section class="automation-section" style="margin-top: 24px;">
                    <header class="queue-header">
                        <h2>Webhook Metrics</h2>
                        <span id="delivery-metrics-updated" class="queue-updated">—</span>
                    </header>
                    <div class="delivery-metrics">
                        <div class="health-grid">
                            <div class="health-card">
                                <span class="health-label">Sample Size</span>
                                <span class="health-value" id="delivery-metrics-samples">—</span>
                            </div>
                            <div class="health-card">
                                <span class="health-label">Failures</span>
                                <span class="health-value" id="delivery-metrics-failures">—</span>
                            </div>
                            <div class="health-card">
                                <span class="health-label">Failure Rate</span>
                                <span class="health-value" id="delivery-metrics-rate">—</span>
                            </div>
                            <div class="health-card">
                                <span class="health-label">Test Deliveries</span>
                                <span class="health-value" id="delivery-metrics-tests">—</span>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="queue-section" style="margin-top: 24px;">
                    <header class="queue-header">
                        <h2>Guardrails Alerts</h2>
                        <span id="alerts-updated" class="queue-updated">—</span>
                    </header>
                    <div class="queue-panel">
                        <div class="queue-empty" id="alerts-empty">No active alerts.</div>
                        <table class="aui aui-table aui-table-rowhover" id="alerts-table" style="display:none;">
                            <thead>
                            <tr>
                                <th>Severity</th>
                                <th>Summary</th>
                                <th>Details</th>
                                <th>Recommendation</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        <div class="queue-note" id="alerts-note">Alerts refresh whenever telemetry loads.</div>
                    </div>
                </section>

                <section class="queue-section" style="margin-top: 24px;">
                    <header class="queue-header">
                        <h2>Guardrails Health Timeline</h2>
                        <span id="health-timeline-updated" class="queue-updated">—</span>
                    </header>
                    <div class="queue-panel">
                        <div class="queue-empty" id="health-timeline-empty">Loading timeline…</div>
                        <table class="aui aui-table aui-table-rowhover" id="health-timeline-table" style="display:none;">
                            <thead>
                            <tr>
                                <th>When</th>
                                <th>Type</th>
                                <th>Summary</th>
                                <th>Details</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </section>
            </div>
        </section>
    </div>
</div>
</body>
</html>
